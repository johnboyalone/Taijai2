<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ทายเลขทายใจ ภาค 2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mitr:wght@300;400;500&family=Kanit:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <!-- ★★★ FIREBASE SDK (เพิ่มส่วนนี้) ★★★ -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
    <div id="game-container">

        <!-- ★★★ LOBBY SCREEN (หน้าจอใหม่) ★★★ -->
        <div id="lobby-screen" class="screen">
            <h1>ทายเลขทายใจ ภาค 2</h1>
            <div class="lobby-group">
                <label for="player-name-input">ชื่อของคุณ:</label>
                <input type="text" id="player-name-input" class="input-field" placeholder="ใส่ชื่อผู้เล่น..." maxlength="15">
            </div>
            <div class="lobby-group">
                <button id="create-room-btn" class="btn-primary">สร้างห้องใหม่</button>
            </div>
            <div class="lobby-group or-divider"><span>หรือ</span></div>
            <div class="lobby-group">
                <input type="text" id="join-room-input" class="input-field" placeholder="ใส่รหัสห้อง..." maxlength="4">
                <button id="join-room-btn" class="btn-secondary">เข้าร่วมห้อง</button>
            </div>
            <div id="lobby-error-msg" class="error-message"></div>
        </div>

        <!-- ★★★ WAITING ROOM SCREEN (หน้าจอใหม่) ★★★ -->
        <div id="waiting-room-screen" class="screen hidden">
            <h2>ห้องรอเล่น</h2>
            <div class="room-code-display">
                รหัสห้อง: <span id="room-code-text">----</span>
                <button id="copy-room-code-btn" class="copy-btn">คัดลอก</button>
            </div>
            <h3>ผู้เล่นในห้อง:</h3>
            <ul id="player-list-waiting">
                <!-- รายชื่อผู้เล่นจะถูกเพิ่มที่นี่โดย script.js -->
            </ul>
            <p id="waiting-status-text">รอเจ้าของห้อง (Host) เริ่มเกม...</p>
            <button id="start-game-from-waiting-btn" class="btn-primary hidden">เริ่มเกม!</button>
        </div>


        <!-- Welcome Screen (ซ่อนไว้ก่อน) -->
        <div id="welcome-screen" class="screen hidden">
            <h1>ทายเลขทายใจ ภาค 2</h1>
            <div class="rules">
                <h3>กติกาการเล่น</h3>
                <p>
                    <strong>เป้าหมาย:</strong> ยืนหยัดเป็นผู้เล่นคนสุดท้ายที่รอดชีวิต!
                </p>
                <p>
                    <strong>การเล่น:</strong> ในแต่ละรอบ จะมีผู้เล่น 1 คนถูกเลือกเป็น "เป้าหมาย" ผู้เล่นที่เหลือทั้งหมดจะต้องทาย "เลขลับ" ของเป้าหมาย
                </p>
                <p>
                    <strong>การทาย:</strong> เมื่อทายเลข จะได้รับผลเป็น "ถูกตำแหน่ง (Strike)" และ "ถูกเลข (Ball)" เพื่อใช้เป็นคำใบ้ในการทายครั้งต่อไป
                </p>
                <p>
                    <strong>การแพ้:</strong>
                    <br>- ทายเลขลับของเป้าหมายผิดด้วยปุ่ม <strong>"ตุยซะเถอะ"</strong> จะเสียพลังชีวิต 1 ดวง
                    <br>- หากปล่อยให้ **เวลาหมด** โดยไม่กดทาย จะเสียพลังชีวิต 1 ดวง
                    <br>- เมื่อพลังชีวิตหมด (0 ดวง) จะถูกคัดออกจากเกม
                </p>
                <p>
                    <strong>การชนะ:</strong> หากทายเลขลับของเป้าหมายถูกด้วยปุ่ม <strong>"ตุยซะเถอะ"</strong> เป้าหมายจะถูกคัดออกจากเกมทันที!
                </p>
            </div>
            <button id="show-setup-btn" class="btn-primary">เริ่มเกม</button>
        </div>

        <!-- Setup Screen (ยังคงอยู่ แต่จะถูกเรียกใช้โดย Host) -->
        <div id="setup-screen" class="screen hidden">
            <h2>ตั้งค่าเกม</h2>
            <div class="setup-group">
                <label>จำนวนผู้เล่น:</label>
                <div id="player-count-selector" class="selector-container"></div>
            </div>
            <div class="setup-group">
                <label>จำนวนหลัก:</label>
                <div id="digit-count-selector" class="selector-container"></div>
            </div>
            <button id="start-game-btn" class="btn-primary">เริ่มเล่น</button>
        </div>

        <!-- Game Screen (ไม่เปลี่ยนแปลง) -->
        <div id="game-screen" class="screen hidden">
            <div id="status-header">
                <div id="main-status-text">ตาของฉัน</div>
                <div id="sub-status-text">เป้าหมาย: ผู้เล่น 2</div>
            </div>

            <div id="players-bar">
                <svg id="energy-beam-svg" class="hidden">
                    <defs>
                        <linearGradient id="beam-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:var(--accent-color-1);stop-opacity:1" />
                            <stop offset="100%" style="stop-color:var(--accent-color-2);stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path id="energy-beam-path" d="" stroke="url(#beam-gradient)" stroke-width="4" stroke-linecap="round" fill="none"/>
                </svg>
                <div id="shout-guess-display" class="hidden"></div>
            </div>

            <div id="my-secret-number-area">
                <div class="secret-label">เลขลับของคุณ (แตะเพื่อซ่อน/แสดง)</div>
                <div id="my-secret-number-display">----</div>
            </div>

            <div id="timer-container">
                <div id="timer-bar"></div>
            </div>

            <div id="display-area">
                <div id="guess-display">----</div>
            </div>

            <div id="action-area">
                <div id="keypad">
                    <button class="key num">1</button>
                    <button class="key num">2</button>
                    <button class="key num">3</button>
                    <button class="key num">4</button>
                    <button class="key num">5</button>
                    <button class="key num">6</button>
                    <button class="key num">7</button>
                    <button class="key num">8</button>
                    <button class="key num">9</button>
                    <button class="key action" id="clear-btn">ลบ</button>
                    <button class="key num">0</button>
                    <button class="key action" id="submit-guess-btn">ทาย</button>
                </div>
                <button class="key eliminate" id="eliminate-btn">ตุยซะเถอะ!</button>
            </div>
        </div>

        <!-- Game Over Screen (ไม่เปลี่ยนแปลง) -->
        <div id="game-over-screen" class="screen hidden">
            <!-- Part 1: Winner Announcement -->
            <div id="winner-announcement" class="game-over-part">
                <h2 class="game-over-title">ผู้ชนะคือ...</h2>
                <div class="winner-name-text" id="winner-name">ผู้เล่น 1</div>
                <div class="winner-secret-label">เลขลับของผู้ชนะ</div>
                <div class="winner-secret-text" id="winner-secret-number">1234</div>
                <div class="next-prompt">แตะเพื่อไปต่อ...</div>
            </div>

            <!-- Part 2: Epithet Reveal -->
            <div id="epithet-reveal" class="game-over-part hidden">
                 <h2 class="game-over-title">ฉายาประจำเกม</h2>
                 <div id="epithet-card-container">
                    <div id="epithet-card-display" class="epithet-card hidden">
                        <div class="epithet-main-content">
                            <div class="epithet-player-name"></div>
                            <div class="epithet-title"></div>
                        </div>
                        <div class="epithet-icon"></div>
                        <div class="epithet-description"></div>
                    </div>
                 </div>
                 <div class="next-prompt hidden">แตะเพื่อดูสรุปสถิติ...</div>
            </div>

            <!-- Part 3: Stats Table -->
            <div id="stats-container" class="game-over-part hidden">
                <h3>สรุปสถิติ</h3>
                <div class="stats-table-wrapper">
                    <table id="stats-table">
                        <tbody id="stats-table-body"></tbody>
                    </table>
                </div>
            </div>
            <button id="restart-game-btn" class="btn-primary hidden">เล่นอีกครั้ง</button>
        </div>
    </div>

    <!-- Floating UI Elements (ไม่เปลี่ยนแปลง) -->
    <div id="elimination-skull-animation" class="hidden">💀</div>
    <button id="popup-history-btn" class="hidden">
        <span class="icon">📖</span>
        <div class="preview-text"></div>
    </button>

    <div id="history-popup-overlay">
        <div id="history-popup">
            <h3>ประวัติการทายของฉัน</h3>
            <div id="history-filter-buttons"></div>
            <ul id="history-popup-list"></ul>
        </div>
    </div>

    <script type="module" src="script.js"></script>
</body>
</html>
